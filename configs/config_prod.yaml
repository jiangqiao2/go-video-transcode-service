# 转码服务生产环境配置（k3s）
server:
  host: "0.0.0.0"
  port: 8083
  mode: release
  read_timeout: 60s
  write_timeout: 60s

database:
  host: "mysql.go-video.svc"
  port: 3306
  username: "root"
  password: "jiangqiao"
  database: transcode_service
  charset: utf8mb4
  parse_time: true
  loc: Local
  max_idle_conns: 10
  max_open_conns: 100
  conn_max_lifetime: 3600s

redis:
  host: "redis"
  port: 6379
  password: ""
  db: 2
  pool_size: 10
  min_idle_conns: 5
  dial_timeout: 5s
  read_timeout: 3s
  write_timeout: 3s
  enable_tls: false

rustfs:
  endpoint: "rustfs.go-video.svc:9000"
  access_key: "jiangqiao"
  secret_key: "jiangqiao"
  use_ssl: false

public:
  storage_base: ""

transcode:
  ffmpeg:
    binary_path: "ffmpeg"
    temp_dir: "/tmp/transcode"
    max_concurrent_tasks: 15
    timeout: 3600s
    video_codec: "h264_nvenc"
    hardware_accel: "cuda"
    use_hardware_decode: true
    decoder_threads: 1
    cuvid_surfaces: 8
    video_preset: "medium"
    threads: 0
  output_formats:
    - name: "720p"
      resolution: "1280x720"
      bitrate: "2000k"
      codec: "h264_nvenc"
      preset: "medium"

worker:
  enabled: true
  worker_id: "worker-001"
  heartbeat_interval: 10s
  task_poll_interval: 3s
  max_concurrent_tasks: 8
  hls_max_concurrent_tasks: 8
  queue_capacity: 100
  shutdown_grace_period: 30s

scheduler:
  enabled: true
  task_poll_interval: 5s
  worker_heartbeat_timeout: 30s
  max_retry_count: 3
  cleanup_interval: 300s

jwt:
  issuer: "go-video"
  rsa_private_key_path: "/app/certs/private.pem"
  rsa_public_key_path: "/app/certs/public.pem"
  expire_time: 24h
  refresh_expire_time: 168h

log:
  level: info
  format: json
  output: stdout
  file_path: ""
  max_size: 100
  max_backups: 7
  max_age: 30
  compress: true

grpc_server:
  host: "0.0.0.0"
  port: 9092

grpc_client:
  timeout: 30s
  max_recv_msg_size: 4194304
  max_send_msg_size: 4194304
  retry_times: 3

dependencies:
  upload_service:
    service_name: "upload-service"
    address: ""
    host: "upload-service.go-video.svc"
    port: 9093
    timeout: 30s
  video_service:
    service_name: "video-service"
    address: ""
    host: "video-service.go-video.svc"
    port: 9094
    timeout: 30s


service_registry:
  enabled: false
  service_name: "transcode-service"
  service_id: "transcode-service-1"
  register_host: ""
  ttl: 30s
  refresh_interval: 10s
kafka:
  enabled: true
  client_id: "transcode-service"
  group_id: "transcode-service-group"
  bootstrap_servers:
    - "kafka:19092"
  topics:
    transcode_tasks: "transcode.tasks"
  commit_on_decode_error: true
  commit_on_process_error: false
