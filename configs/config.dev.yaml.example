# 转码服务开发环境配置模板
server:
  port: 8082
  mode: debug
  read_timeout: 60s
  write_timeout: 60s

# 数据库配置
database:
  host: localhost
  port: 3306
  username: "YOUR_DATABASE_USERNAME"
  password: "YOUR_DATABASE_PASSWORD"
  database: transcode_service
  charset: utf8mb4
  parse_time: true
  loc: Local
  max_idle_conns: 10
  max_open_conns: 100
  conn_max_lifetime: 3600s

# Redis配置
redis:
  host: localhost
  port: 6379
  password: "YOUR_REDIS_PASSWORD"
  db: 2
  pool_size: 10
  min_idle_conns: 5
  dial_timeout: 5s
  read_timeout: 3s
  write_timeout: 3s
  enable_tls: false

# MinIO配置
minio:
  endpoint: localhost:9000
  access_key: "YOUR_MINIO_ACCESS_KEY"
  secret_key: "YOUR_MINIO_SECRET_KEY"
  use_ssl: false
  bucket_name: transcode-videos

# RustFS配置
rustfs:
  endpoint: "124.221.86.127:9000"
  access_key: "YOUR_RUSTFS_ACCESS_KEY"
  secret_key: "YOUR_RUSTFS_SECRET_KEY"
  use_ssl: false

# 转码配置
transcode:
  # FFmpeg配置
  ffmpeg:
    binary_path: "/usr/local/bin/ffmpeg"
    temp_dir: "/tmp/transcode"
    max_concurrent_tasks: 4
    timeout: 3600s
  
  # 输出格式配置
  output_formats:
    - name: "720p"
      resolution: "1280x720"
      bitrate: "2000k"
      codec: "libx264"
      preset: "medium"
    - name: "480p"
      resolution: "854x480"
      bitrate: "1000k"
      codec: "libx264"
      preset: "medium"
    - name: "360p"
      resolution: "640x360"
      bitrate: "500k"
      codec: "libx264"
      preset: "fast"

# 调度器配置
scheduler:
  enabled: true
  task_poll_interval: 5s
  worker_heartbeat_timeout: 30s
  max_retry_count: 3
  cleanup_interval: 300s

# Worker配置
worker:
  enabled: true
  worker_id: "worker-001"
  heartbeat_interval: 10s
  task_poll_interval: 3s
  max_concurrent_tasks: 2

# JWT配置
jwt:
  secret: "YOUR_JWT_SECRET_KEY"
  issuer: "go-video"
  rsa_private_key_path: "./certs/jwtRS256.key"
  rsa_public_key_path: "./certs/jwtRS256.key.pub"
  expire_time: 24h
  refresh_expire_time: 168h

# 日志配置
log:
  level: debug
  format: json
  output: stdout
  file_path: "/var/log/transcode-service/app.log"
  max_size: 100
  max_backups: 7
  max_age: 30
  compress: true
grpc_server:
  host: "0.0.0.0"
  port: 9092

grpc_client:
  timeout: 30s
  max_recv_msg_size: 4194304
  max_send_msg_size: 4194304
  retry_times: 3

# etcd configuration
etcd:
  endpoints: []   # 留空表示不使用etcd
  dial_timeout: 5s
  request_timeout: 3s
  username: ""
  password: ""

# Service registry configuration
service_registry:
  enabled: false
  service_name: "transcode-service"
  service_id: "transcode-service-1"
  register_host: "127.0.0.1"
  ttl: 30s
  refresh_interval: 10s

dependencies:
  upload_service:
    address: "localhost:9093"  # 无etcd时直连地址
    service_name: "upload-service"
    timeout: 30s
